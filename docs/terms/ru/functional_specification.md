# Функциональная спецификация модуля `terms`

## 1. Назначение и область действия

Данный документ описывает функциональные возможности и программный интерфейс модуля `tipster.terms`.

Этот модуль предоставляет конкретную реализацию в Clojure для фундаментальных концепций (Терм, Функтор, Переменная, Атом), которые определены в основополагающем документе [Ключевые концепции Tipster](./../concepts/ru/core.md). Вся терминология, используемая здесь, должна интерпретироваться в строгом соответствии с этим документом.

## 2. Реализация типов термов

Модуль `tipster.terms` определяет следующие структуры данных для представления термов в памяти:

### 2.1. Переменная (`Variable`)
*   **Реализация**: `(defrecord Variable [name id])`
*   **Описание**: Представляет переменную, как определено в `core.md`. Поле `id` используется для обеспечения уникальности в процессе унификации.

### 2.2. Атом (`Atom`)
*   **Реализация**: `(defrecord Atom [value])`
*   **Описание**: Представляет атомарный (константный) терм. Поле `value` может содержать любое значение Clojure.

### 2.3. Составной терм (`Compound`)
*   **Реализация**: `(defrecord Compound [functor args])`
*   **Описание**: Представляет составной терм. Поле `functor` хранит имя функтора, а `args` — вектор дочерних термов.

Все три структуры реализуют протокол `ITerm`, который обеспечивает полиморфное поведение для всех видов термов.

## 3. Конструкторы и преобразования

### 3.1. Функции-конструкторы
Модуль предоставляет явные функции для создания экземпляров термов:
*   `(make-variable "name")`: Создает переменную.
*   `(make-atom value)`: Создает атом.
*   `(make-compound 'functor & args)`: Создает составной терм.

### 3.2. Автоматическое преобразование (Отображение $φ$)
Функция `(clojure-term->tipster-term data)` реализует формальное отображение $φ$ из стандартных структур данных Clojure в термы Tipster, как это описано в `core.md`. Она рекурсивно преобразует списки, векторы, символы и другие типы данных в соответствующие объекты `Variable`, `Atom` или `Compound`.

### 3.3. Обратное преобразование (Отображение $φ⁻¹$)
Функция `(tipster-term->clojure-term term bindings deref-fn)` реализует обратное отображение $φ⁻¹$, преобразуя внутренние термы Tipster обратно в удобные для чтения структуры данных Clojure.

## 4. Функциональные требования

### R1: Реализация структур
*   Модуль должен предоставлять структуры `Variable`, `Atom`, `Compound` для представления термов.
*   Все структуры должны реализовывать протокол `ITerm`.

### R2: Создание термов
*   Должны существовать функции `make-variable`, `make-atom`, `make-compound`.
*   Должна быть реализована функция `clojure-term->tipster-term`, выполняющая полное рекурсивное преобразование.

### R3: Инспекция термов
*   Протокол `ITerm` должен предоставлять функции для определения типа терма (`term-type`) и его свойств (`is-variable?`, `is-compound?`).

### R4: Обратное преобразование
*   Должна существовать функция `tipster-term->clojure-term` для преобразования термов в структуры данных Clojure.
*   Функция должна корректно обрабатывать привязки переменных (`bindings`) для их отображения.
