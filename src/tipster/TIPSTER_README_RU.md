# Tipster - Функционально-логический движок

Реализация унификационного движка и логического солвера для языка Tipster, обеспечивающего интеграцию функционального программирования Clojure с декларативным логическим программированием.

## Архитектура

### Основные компоненты

```
src/tipster/core.clj          - Основной код логического движка
test/tipster/core_test.clj    - Тесты унификации и логического вывода
deps.edn                      - Зависимости проекта
```

## Использование

### Базовая работа с термами

```clojure
(require '[tipster.core :as t])

;; Создание термов
(def var-x (t/make-variable "X"))
(def atom-a (t/make-atom 'a))
(def compound (t/make-compound 'f 'a 'b))

;; Унификация
(t/unify var-x atom-a)  ; => {<id-var-x> atom-a}
```

### Работа с фактами и правилами

```clojure
;; Определение фактов через макрос
(t/deffact (человек алиса))
(t/deffact (человек боб))
(t/deffact (родитель алиса боб))

;; Определение правил
(t/defrule (дедушка ?X ?Z) 
  [(родитель ?X ?Y) (родитель ?Y ?Z)])

;; Запросы
(t/query (человек ?X))        ; Найти всех людей
(t/query (дедушка алиса ?Z))  ; Найти внуков Алисы
```

### Интеграция с Clojure

```clojure
;; Преобразование данных
(t/clojure-term->tipster-term '(f ?X a))
(t/tipster-term->clojure-term compound {})

;; Работа с предикатами Clojure
(t/integrate-clojure-predicate integer?)
```

## Ключевые особенности

### 1. Унификационный алгоритм Робинсона

- **Полная унификация** любых термов
- **Occurs check** для предотвращения бесконечных структур
- **Эффективная дереференсация** переменных

```clojure
;; Унификация составных термов
(t/unify (t/make-compound 'f (t/make-variable "X") 'b)
         (t/make-compound 'f 'a (t/make-variable "Y")))
;; => {<X-id> atom-a, <Y-id> atom-b}
```

### 2. Логический солвер

- **Резолюция** с использованием SLD-стратегии
- **Поиск в ширину** всех решений
- **Ленивые вычисления** для эффективной обработки больших пространств поиска

```clojure
;; Решение множественных целей
(t/solve-goals [(t/make-compound 'родитель 'алиса (t/make-variable "X"))
                (t/make-compound 'возраст (t/make-variable "X") (t/make-variable "Y"))])
```

### 3. База знаний

- **Факты** - базовые утверждения
- **Правила** - логические импликации
- **Динамическое обновление** в runtime

```clojure
;; Программное управление базой знаний
(t/add-fact! (t/make-compound 'likes 'mary 'food))
(t/add-rule! head-term [body-term1 body-term2])
(t/clear-knowledge-base!)
```

### 4. Интеграция с Clojure

- **Двунаправленное преобразование** данных
- **Использование предикатов Clojure** в логических правилах
- **Макросы** для удобного синтаксиса

```clojure
;; Встроенные предикаты
'= '> '< 'integer? 'string?

;; Пользовательские предикаты
(defn возраст-больше [person age]
  (and (t/solve-goal (t/make-compound 'возраст person (t/make-variable "A")))
       (> age 18)))
```

## Архитектурные решения

### 1. Протокол ITerm

Единый интерфейс для всех типов термов:

```clojure
(defprotocol ITerm
  (term-type [this])
  (term-value [this])
  (is-variable? [this])
  (is-compound? [this]))
```

### 2. Система связывания переменных

```clojure
;; Среда связывания - простая хеш-таблица
{variable-id term}

;; Операции
(empty-bindings)
(lookup-binding var bindings)
(bind-variable var term bindings)
```

### 3. Переименование переменных

Автоматическое переименование переменных в правилах для избежания конфликтов:

```clojure
(defn rename-variables [term]
  ;; Создает новые уникальные имена для всех переменных
  )
```

## Производительность

### Оптимизации

1. **Ленивые последовательности** - решения вычисляются по требованию
2. **Мемоизация** - кеширование результатов унификации
3. **Эффективная дереференсация** - минимум рекурсивных вызовов
4. **Индексирование фактов** - быстрый поиск по функтору

### Масштабируемость

- Поддержка больших баз знаний (тысячи фактов)
- Эффективная работа с глубокой рекурсией
- Управление памятью через GC Clojure

## Сравнение с альтернативами

| Характеристика | WAM | Tipster | SWI-Prolog |
|----------------|-----|---------|------------|
| Целевой язык | Prolog | Clojure+Logic | Prolog |
| Интеграция | Низкая | Высокая | Средняя |
| Производительность | Высокая | Средняя | Высокая |
| Простота использования | Низкая | Высокая | Средняя |
| Расширяемость | Низкая | Высокая | Средняя |

## Будущее развитие

### Планируемые улучшения

1. **CLP(FD)** - Constraint Logic Programming over Finite Domains
2. **Tabling** - мемоизация для предотвращения бесконечной рекурсии
3. **Компилятор** - оптимизация кода Tipster
4. **Индексирование** - продвинутые структуры данных для поиска
5. **Параллелизм** - использование возможностей JVM

### Интеграция с экосистемой

- **DataScript** - логические запросы к базам данных
- **Datomic** - временные запросы и транзакции
- **core.logic** - совместимость с существующими решениями

## Примеры использования

### Семейные отношения

```clojure
;; Факты
(t/deffact (родитель том боб))
(t/deffact (родитель боб пэт))
(t/deffact (родитель пэт энн))

;; Правила
(t/defrule (дедушка ?X ?Z) 
  [(родитель ?X ?Y) (родитель ?Y ?Z)])

(t/defrule (предок ?X ?Z)
  [(родитель ?X ?Z)])
  
(t/defrule (предок ?X ?Z)
  [(родитель ?X ?Y) (предок ?Y ?Z)])

;; Запросы
(t/query (дедушка том ?X))   ; => [(дедушка том пэт)]
(t/query (предок том ?X))   ; => [(предок том боб) (предок том пэт) (предок том энн)]
```

### Сложные структуры данных

```clojure
;; Списки
(t/deffact (список [1 2 3]))
(t/deffact (длина [1 2 3] 3))

;; Деревья
(t/deffact (дерево (узел лист 5 лист)))
(t/defrule (в-дереве ?X (узел ?L ?X ?R)) [])
(t/defrule (в-дереве ?X (узел ?L ?V ?R)) [(в-дереве ?X ?L)])
(t/defrule (в-дереве ?X (узел ?L ?V ?R)) [(в-дереве ?X ?R)])
```

## Заключение

Tipster представляет собой современную альтернативу классическим логическим языкам, обеспечивая:

- **Простоту использования** благодаря синтаксису Clojure
- **Мощность логического программирования** с полной унификацией
- **Интеграцию с JVM-экосистемой** для практических применений
- **Гибкость архитектуры** для различных предметных областей

Это делает Tipster идеальным инструментом для построения экспертных систем, систем управления знаниями и сложной бизнес-логики на современной технологической платформе.
